<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
<div class="container">
    <header>
        <h1>Panel de Administración</h1>
        <div class="user-info">
            <span>Bienvenido, <strong th:text="${usuario.username}">Admin</strong></span>
            <a th:href="@{/perfil/cambiar-password}" class="btn btn-small">Cambiar Contraseña</a>
            <form th:action="@{/logout}" method="post" style="display: inline;">
                <button type="submit" class="btn btn-small btn-danger">Cerrar Sesión</button>
            </form>
        </div>
    </header>

    <!-- Mensajes -->
    <div th:if="${mensaje}" class="alert alert-success" th:text="${mensaje}"></div>
    <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

    <div class="section">
        <div class="section-header">
            <h2>Gestión de Usuarios</h2>
            <a th:href="@{/admin/usuarios/nuevo}" class="btn btn-success">+ Crear Nuevo Usuario</a>
        </div>

        <table class="table">
            <thead>
            <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Roles</th>
                <th>Activo</th>
                <th>Intentos Fallidos</th>
                <th>Último Login</th>
                <th>Fecha Creación</th>
                <th>Acciones</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="u : ${usuarios}">
                <td th:text="${u.id}">1</td>
                <td th:text="${u.username}">admin</td>
                <td th:text="${u.email}">admin@example.com</td>
                <td>
                            <span th:each="rol, iterStat : ${u.roles}">
                                <span th:text="${rol.nombre}">ADMIN</span>
                                <span th:if="${!iterStat.last}">, </span>
                            </span>
                </td>
                <td>
                    <span th:if="${u.activo}" class="badge badge-success">Sí</span>
                    <span th:unless="${u.activo}" class="badge badge-danger">No</span>
                </td>
                <td th:text="${u.intentosFallidos}">0</td>
                <td th:text="${u.ultimoLogin != null ? #temporals.format(u.ultimoLogin, 'dd/MM/yyyy HH:mm') : 'Nunca'}">-</td>
                <td th:text="${#temporals.format(u.fechaCreacion, 'dd/MM/yyyy HH:mm')}">01/01/2024</td>
                <td class="actions">
                    <a th:href="@{/admin/usuarios/ver/{id}(id=${u.id})}" class="btn btn-small btn-info">Ver</a>
                    <a th:href="@{/admin/usuarios/editar/{id}(id=${u.id})}" class="btn btn-small btn-warning">Editar</a>
                    <a th:if="${u.activo}"
                       th:href="@{/admin/usuarios/desactivar/{id}(id=${u.id})}"
                       class="btn btn-small btn-secondary"
                       onclick="return confirm('¿Desactivar este usuario?')">Desactivar</a>
                    <a th:href="@{/admin/usuarios/eliminar/{id}(id=${u.id})}"
                       class="btn btn-small btn-danger"
                       onclick="return confirm('¿Estás seguro de eliminar este usuario?')">Eliminar</a>
                </td>
            </tr>
            </tbody>
        </table>

        <div th:if="${usuarios.isEmpty()}" class="empty-state">
            <p>No hay usuarios registrados</p>
        </div>
    </div>
</div>
</body>
</html>